# FEATURE.md

경기 파트너스의 구현된 기능을 사용자 관점에서 설명합니다.

## 1. 사용자 인증 (Authentication)

### 회원가입
- **기능**: 새로운 계정을 생성할 수 있습니다
- **엔드포인트**: `POST /api/users/signup`
- **절차**:
  1. 이메일 인증번호 발송 요청
  2. 이메일로 받은 6자리 인증번호 입력 및 검증
  3. 회원가입 정보 입력 (이메일, 비밀번호 등)

### 이메일 인증
- **인증번호 발송**
  - **엔드포인트**: `POST /api/users/email/send`
  - **기능**: 입력한 이메일로 6자리 인증번호를 발송합니다
  - **유효시간**: 5분

- **인증번호 검증**
  - **엔드포인트**: `POST /api/users/email/verify`
  - **기능**: 발송된 인증번호가 올바른지 확인합니다

### 로그인/로그아웃
- **로그인**
  - **엔드포인트**: `POST /api/auth/login`
  - **기능**: 이메일과 비밀번호로 로그인하여 JWT 토큰을 발급받습니다
  - **응답**: Access Token (1시간 유효) + Refresh Token (7일 유효)

- **로그아웃**
  - **엔드포인트**: `POST /api/auth/logout`
  - **기능**: 로그아웃하고 Refresh Token을 무효화합니다
  - **인증 필요**: ✅

### 토큰 갱신
- **엔드포인트**: `POST /api/auth/refresh`
- **기능**: Access Token이 만료되었을 때 Refresh Token으로 새로운 Access Token을 발급받습니다
- **사용 시나리오**: Access Token 만료 시 재로그인 없이 계속 사용 가능

---

## 2. 논의방 (Discussion Room)

### 논의방 생성
- **엔드포인트**: `POST /api/discussion-rooms/create`
- **기능**: 새로운 논의방을 만들 수 있습니다
- **입력 정보**:
  - 제목 (title)
  - 설명 (description)
  - 지역 (region) - 경기도 내 지역 선택
  - 접근 레벨 (accessLevel) - 공개/비공개 설정
- **자동 처리**: 논의방을 만든 사람은 자동으로 해당 방에 참여됩니다
- **인증 필요**: ✅

### 논의방 목록 조회
- **전체 논의방 목록**
  - **엔드포인트**: `GET /api/discussion-rooms/retrieveTotal`
  - **기능**: 모든 논의방을 최신순으로 조회합니다
  - **페이징 지원**: 기본 15개씩, 페이지 번호로 탐색 가능
  - **인증 필요**: ✅

- **내가 참여한 논의방 목록**
  - **엔드포인트**: `GET /api/discussion-rooms/retrieveMyJoined`
  - **기능**: 현재 사용자가 참여 중인 논의방을 최신 참여순으로 조회합니다
  - **페이징 지원**: 기본 15개씩, 페이지 번호로 탐색 가능
  - **인증 필요**: ✅

### 논의방 입장
- **엔드포인트**: `POST /api/discussion-rooms/{roomId}/join`
- **기능**: 특정 논의방에 입장합니다
- **응답 정보**:
  - 논의방 상세 정보 (제목, 설명, 지역, 생성일 등)
  - 현재 참여 중인 멤버 목록
- **인증 필요**: ✅

### 논의방 나가기
- **엔드포인트**: `DELETE /api/discussion-rooms/{roomId}/leave`
- **기능**: 참여 중인 논의방에서 나갑니다
- **특수 처리**: 마지막 멤버가 나가면 논의방이 자동으로 삭제됩니다 (Soft Delete)
- **인증 필요**: ✅

---

## 3. 실시간 채팅 (Chat)

### 실시간 메시지 전송
- **WebSocket 엔드포인트**: `/chat.sendMessage`
- **프로토콜**: STOMP over WebSocket
- **기능**: 논의방 내에서 실시간으로 메시지를 주고받을 수 있습니다
- **기술 특징**:
  - WebSocket 연결을 통한 양방향 통신
  - Redis Pub/Sub을 활용한 다중 서버 환경 지원
  - 메시지는 실시간 전송과 동시에 DB에 저장됨

### 채팅방 참여 알림
- **WebSocket 엔드포인트**: `/chat.addUser`
- **기능**: 사용자가 채팅방에 입장했을 때 다른 참여자들에게 알립니다
- **세션 관리**: WebSocket 세션에 사용자 정보를 저장하여 관리합니다

### 채팅 기록 조회
- **엔드포인트**: `GET /api/messages/rooms/{roomId}`
- **기능**: 논의방의 이전 채팅 기록을 조회합니다
- **쿼리 파라미터**:
  - `cursor`: 조회 시작 위치 (메시지 ID 기반, 없으면 최신 메시지부터)
  - `size`: 조회할 메시지 개수 (기본값: 30개)
- **페이징 방식**: 커서 기반 페이징 (Cursor-based Pagination)
  - 최신 메시지부터 과거로 이동하며 조회
  - 무한 스크롤 방식에 적합

---

## 사용 흐름 예시

### 📱 신규 사용자의 서비스 이용 과정

1. **회원가입**
   ```
   이메일 입력 → 인증번호 받기 → 인증번호 확인 → 회원정보 입력 → 가입 완료
   ```

2. **로그인**
   ```
   이메일/비밀번호 입력 → JWT 토큰 발급 → 서비스 이용 시작
   ```

3. **논의방 찾기**
   ```
   전체 논의방 목록 조회 → 관심있는 논의방 선택 → 논의방 입장
   ```

4. **논의방 생성 및 채팅**
   ```
   새 논의방 만들기 → 제목/설명/지역 입력 → 생성 완료 (자동 입장)
   → WebSocket 연결 → 실시간 채팅 시작
   ```

5. **채팅 기록 확인**
   ```
   논의방 입장 → 최근 30개 메시지 조회 → 스크롤 위로 → 이전 메시지 더보기
   ```

6. **논의방 나가기**
   ```
   나가기 버튼 클릭 → 멤버 목록에서 제거 → 내 참여 목록에서 제거
   ```

---

## 기술적 특징

### 성능 최적화
- **Redis 캐싱**: 논의방 정보와 목록을 Redis에 캐싱하여 빠른 조회 제공
- **커서 기반 페이징**: 대량의 메시지 데이터를 효율적으로 조회
- **실시간 통신**: WebSocket + Redis Pub/Sub으로 다중 서버 환경에서도 실시간 메시징 지원

### 보안
- **JWT 토큰 인증**: 모든 API는 JWT 토큰으로 사용자 인증
- **이메일 인증**: 회원가입 시 이메일 소유권 확인
- **토큰 만료 관리**: Access Token (1시간), Refresh Token (7일)
- **Soft Delete**: 데이터 삭제 시 실제로는 삭제 플래그만 설정 (데이터 복구 가능)

### 사용자 경험
- **자동 입장**: 논의방 생성자는 자동으로 입장 처리
- **페이징 지원**: 목록이 많을 때 페이지 단위로 나눠서 조회
- **실시간 알림**: 사용자 입장 시 다른 참여자들에게 실시간 알림
- **메시지 히스토리**: 과거 채팅 기록을 언제든지 조회 가능

---

## API 문서

모든 API는 Swagger UI에서 테스트할 수 있습니다:
- **Swagger UI**: http://localhost:8080/swagger-ui.html
- **API Docs JSON**: http://localhost:8080/v3/api-docs

각 API의 자세한 요청/응답 스키마와 예시는 Swagger UI에서 확인할 수 있습니다.
